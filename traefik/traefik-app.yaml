apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: traefik
  namespace: argocd
spec:
  project: default
  source:
    chart: traefik
    repoURL: https://helm.traefik.io/traefik
    targetRevision: 10.14.2
    helm:
      values: |
        ports:
          argocd:
            port: 30443
            expose: true
            exposedPort: 30443
            protocol: TCP         
          traefik:
            port: 9000
            expose: false
            exposedPort: 9000
            protocol: TCP        
          apigw:
            port: 9090
            expose: false
            exposedPort: 9090
            protocol: TCP
          metrics:
            port: 9100
            expose: false
            exposedPort: 9100
            protocol: TCP
          consul:
            port: 8500
            expose: false
            exposedPort: 8500
            protocol: TCP
          grafana:
            port: 8081
            expose: false
            exposedPort: 8081
            protocol: TCP
            nodePort: 32000

        providers:
          kubernetesCRD:
            enabled: true
            allowCrossNamespace: true

        ingressClass:
          enabled: false
          isDefaultClass: false
          fallbackApiVersion: ""

        service:
          enabled: true
          type: LoadBalancer
          annotations: {
            service.beta.kubernetes.io/aws-load-balancer-internal: "false",
            service.beta.kubernetes.io/aws-load-balancer-type: "nlb",
            # service.beta.kubernetes.io/load-balancer-source-ranges: "164.215.116.246/32",
            # service.beta.kubernetes.io/aws-load-balancer-type: "external",
            # service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: "instance",
            # service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing",
            # service.beta.kubernetes.io/aws-load-balancer-proxy-protocol: "*",
            service.beta.kubernetes.io/aws-load-balancer-name: "marta02-eks-traefik-lb"
          }
          # spec: {
          #   externalTrafficPolicy: Cluster
          # }
            
      
          
        logs:
          general:
            level: DEBUG
          access:
            enabled: true

  destination:
    server: https://kubernetes.default.svc
    namespace: traefik
  syncPolicy:
    automated:
      selfHeal: false